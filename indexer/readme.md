# Guideline for Indexer

Parts of this gist is based on http://magento.stackexchange.com/questions/22157/how-indexing-works-in-magento/22166


There are different kind of indexes in Magento.
All of the indexers are there to make things run faster.
I will cover here only a few of them.

## Flat Index

There are 2 such indexes. One for categories and one for products.
By default the category and product entities (and customers and customer addresses but they are not important in this situation) are EAV entities. This is very nice for extensibility. But it's a performance killer because in order to get all values for all the attributes you need a lot of joins or multiple queries.
Here is where the flat indexer comes into play.
It transforms the EAV structure into a flat structure. I mean it creates a table (one for each store view in Magento) that has one column corresponding to an attribute. This makes selects faster. For categories all attributes are converted to table columns. For products only the ones you mark as 'Used in product listing' because you can sell all types of products with different attributes and creating one table with a gazillion columns may not be possible.
Also, some products may be disabled or may not belong to a certain website and there is no need to include them in the entries to search. They are excluded by the indexer.
The generated flat tables are used for reading data in the fronend. The backend still uses the EAV structure.

### Category
| Resource | Class                                                              |                                  
|----------|--------------------------------------------------------------------|
| indexer      | Mage_Catalog_Model_Category_Indexer_Product                    |                                             
| resource  | Mage_Catalog_Model_Resource_Category_Indexer_Product              |   

### Product

| Resource | Class                                                              |                                  
|----------|--------------------------------------------------------------------|
| indexer      | Mage_Catalog_Model_Category_Indexer_Product                    |                                             
| resource  | Mage_Catalog_Model_Resource_Category_Indexer_Product              |   

## Catalog Search Index
You can search for products by many attribute values. Some of them may not be included in the flat tables generated by the flat indexer. This index fills in a table with the searchable attribute values for products so it's easier to look for them based on keywords. Having all the info in one table (or one field) makes it possible to use Full text search and get relevant results.

## Product Prices.
The price of a product can be affected by many variables. For example, customer group, website, catalog discount rules.
Same as above, getting the products with their prices will mean a lot of joins or multiple selects. IN addition bundle products have a strange pricing system. This indexer aggregates the data in some tables (catalog_product_index_price_*) and makes the selects (sorting and filtering) much easier.

## Catalog url Rewrites
This cleans up the url rewrite rules by setting which url corresponds to which product or category. It's easier this way for the url management internal system to decide which page should you view when calling a non-standard url. Instead of searching through all the product and categories URL keys it just searches in one table.

## Category Products

In Magento you can set a category attribute named 'Is Anchor' to true or false. If it's true it means that the category in question will list all the products from it's child categories. Again, determining this realtime it will take more resources than just reading one table. This indexer creates the association between products and categories based on the associations you set in the backend and the 'Is Anchor' flag on the categories.

| resource | information                                                        |                                  
|----------|--------------------------------------------------------------------|
| indexer name | catalog_category_product                                       |  
| indexer   | Mage_Catalog_Model_Category_Indexer_Product                       |                                             
| resource  | Mage_Catalog_Model_Resource_Category_Indexer_Product              |
| index table | catalog_category_product_index_idx -> category_product_indexer_idx |

### When you should use it

If you work with a lot of products in anchor categories, then you should use it. This is different to the table ```catalog_category_product_index``` which contains the real association between a ```product``` and a ```category```. The only code where this is used is in ```Mage_Catalog_Model_Resource_Category_Indexer_Product```.

```
public function getIdxTable($table = null)
    {
        if ($this->useIdxTable()) {
            return $this->getTable('catalog/category_product_indexer_idx');
        }
        return $this->getTable('catalog/category_product_indexer_tmp');
    }
}
```

### When you should not use it

If every product is assigned to a category then you will not need it.

### How to avoid it

* Assign every product to a category
* Do not assign simple products but only configurables

## Stock Status
For simple products it's easy. They can be in stock or out of stock, but for configurable, grouped and bundle is not that easy. They can be in stock or out of stock depending on the child products associated to the main product. Again (I'm just repeating my self here) getting their status real time would mean a lot of queries.

## Product Attributes.
This one collects all attributes that can be used in the layered navigation for same reason. Having all of them in one place for faster reading.

## Tag Aggregation
I have no idea what this does. I've never used tags in a real live project.
